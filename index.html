<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poly Art 3D Final</title>
<style>
html, body { margin:0; height:100%; background: linear-gradient(180deg,#fff,#f3f4f6); overflow:hidden; font-family:sans-serif; }
#top-emojis { position:absolute; top:10px; left:0; right:0; text-align:center; font-size:28px; pointer-events:none; z-index:10; user-select:none; }
#three-container { width:100%; height:100%; }
.ui-bottom { position:absolute; bottom:0; width:100%; display:flex; overflow-x:auto; padding:10px; background:rgba(255,255,255,0.6); backdrop-filter:blur(6px); box-shadow:0 -2px 10px rgba(0,0,0,0.05); }
.thumb { width:72px; height:56px; margin-right:10px; border:2px solid transparent; border-radius:6px; overflow:hidden; cursor:pointer; flex:0 0 auto; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
.thumb img { width:100%; height:100%; object-fit:cover; display:block; }
.thumb.active { border-color: rgba(96,165,250,0.85); }
@media(max-width:600px){ .thumb{width:60px; height:46px;} }
</style>
</head>
<body>
<div id="top-emojis">üß∏ ‚ù§Ô∏è üê•</div>
<div id="three-container"></div>
<div class="ui-bottom" id="ui-bottom"></div>

<script src="https://unpkg.com/three@0.154.0/build/three.min.js"></script>
<script>
(function(){
const IMAGES=['foto1.jpeg','foto2.jpeg','foto3.jpeg','foto4.jpeg'];
const container=document.getElementById('three-container');
const scene=new THREE.Scene();
const renderer=new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setPixelRatio(window.devicePixelRatio);
container.appendChild(renderer.domElement);

const camera=new THREE.PerspectiveCamera(50,1,0.1,2000);
scene.add(new THREE.AmbientLight(0xffffff,0.9));
const dirLight=new THREE.DirectionalLight(0xffffff,0.2);
dirLight.position.set(1,1,1);
scene.add(dirLight);

let meshes=[],currentImageIndex=0;
let cols=10, rows=10;

let spherical={theta:0.5, phi:Math.PI/2-0.25, radius:400};
let sphericalTarget={...spherical};
const damping=0.12;
let isPointerDown=false, lastPointer={x:0,y:0};

function getPointer(e){ return e.touches?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}; }
function onPointerDown(e){isPointerDown=true; lastPointer=getPointer(e);}
function onPointerMove(e){ if(!isPointerDown) return; const p=getPointer(e); const dx=p.x-lastPointer.x, dy=p.y-lastPointer.y; lastPointer=p; sphericalTarget.theta-=dx*0.006; sphericalTarget.phi-=dy*0.006; sphericalTarget.phi=Math.max(0.01, Math.min(Math.PI-0.99, sphericalTarget.phi)); }
function onPointerUp(){isPointerDown=false;}
function onWheel(e){e.preventDefault(); sphericalTarget.radius+=e.deltaY*0.6; sphericalTarget.radius=Math.max(120,Math.min(1200,sphericalTarget.radius));}

renderer.domElement.addEventListener('mousedown',onPointerDown);
window.addEventListener('mousemove',onPointerMove);
window.addEventListener('mouseup',onPointerUp);
renderer.domElement.addEventListener('touchstart',onPointerDown,{passive:true});
window.addEventListener('touchmove',onPointerMove,{passive:true});
window.addEventListener('touchend',onPointerUp);
renderer.domElement.addEventListener('wheel',onWheel,{passive:false});

// Crea fragmentos Poly Art
function buildFromImage(img, c, r){
  meshes.forEach(m=>{scene.remove(m); if(m.geometry) m.geometry.dispose(); if(m.material) m.material.dispose();});
  meshes=[];

  const tex=new THREE.Texture(img);
  tex.needsUpdate=true;
  tex.minFilter=THREE.LinearFilter;
  tex.magFilter=THREE.LinearFilter;

  const maxDim=240;
  const aspect=img.width/img.height;
  let planeW=aspect>=1?maxDim:maxDim*aspect;
  let planeH=aspect>=1?maxDim/aspect:maxDim;
  const startX=-planeW/2, startY=planeH/2, cellW=planeW/c, cellH=planeH/r;

  for(let i=0;i<c;i++){
    for(let j=0;j<r;j++){
      const geom=new THREE.PlaneGeometry(cellW,cellH,1,1);
      const mat=new THREE.MeshBasicMaterial({map:tex, transparent:true, side:THREE.DoubleSide});
      const mesh=new THREE.Mesh(geom, mat);

      // Posici√≥n dispersa ligera
      const tx=startX+(i+0.5)*cellW, ty=startY-(j+0.5)*cellH, tz=(Math.random()-0.5)*40;
      mesh.position.set(tx+Math.random()*40-20, ty+Math.random()*40-20, tz);
      meshes.push(mesh);
      scene.add(mesh);
    }
  }

  camera.position.set(0,0,Math.max(planeW,planeH)*1.2);
  camera.lookAt(0,0,0);
}

function resize(){
  const w=container.clientWidth, h=container.clientHeight;
  renderer.setSize(w,h);
  camera.aspect=w/h;
  camera.updateProjectionMatrix();
}
window.addEventListener('resize',resize);

function updateCamera(){
  spherical.theta += (sphericalTarget.theta - spherical.theta)*damping;
  spherical.phi += (sphericalTarget.phi - spherical.phi)*damping;
  spherical.radius += (sphericalTarget.radius - spherical.radius)*damping;
  const r=spherical.radius;
  camera.position.set(r*Math.sin(spherical.phi)*Math.sin(spherical.theta),
                      r*Math.cos(spherical.phi),
                      r*Math.sin(spherical.phi)*Math.cos(spherical.theta));
  camera.lookAt(0,0,0);
}

function render(){
  requestAnimationFrame(render);
  updateCamera();
  renderer.render(scene,camera);
}

// Miniaturas
const uiBottom=document.getElementById('ui-bottom');
IMAGES.forEach((name,idx)=>{
  const div=document.createElement('div'); div.className='thumb'+(idx===0?' active':''); div.dataset.idx=idx;
  const img=document.createElement('img'); img.src=name; div.appendChild(img);
  div.addEventListener('click',()=>{document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active')); div.classList.add('active'); loadImageAtIndex(idx);});
  uiBottom.appendChild(div);
});

function loadImageAtIndex(idx){
  currentImageIndex=idx;
  const img=new Image();
  img.onload=function(){ buildFromImage(img,cols,rows); }
  img.src=IMAGES[idx]+'?v='+Math.random();
}

// Inicializar
resize();
loadImageAtIndex(0);
render();

})();
</script>
</body>
</html>
